{{ $chart := index $.Subcharts "psmdb-db" }}
apiVersion: tf.upbound.io/v1beta1
kind: Workspace
metadata:
  name: {{ include "psmdb-database.fullname" $chart }}-config-tpl
spec:
  providerConfigRef:
    name: mongodb-{{ .Values.env }}-tf

  forProvider:
    source: Inline
    module: |
      resource "mongodb_db_role" "main-new" {
        name = "cn=Network,ou=groups,dc=ldap,dc=mylogin,dc=space"
        
        database = "admin"

        inherited_role {
          role = "readAnyDatabase"
          db =   "admin"
        }

        inherited_role {
          role = "readWriteAnyDatabase"
          db =   "admin"
        }
      }

      resource "mongodb_db_role" "AdminRole" {
        name = "cn=authentik Admins,ou=groups,dc=ldap,dc=mylogin,dc=space"
        
        database = "admin"
        
        privilege {
          db = "admin"
          collection = ""
          actions = ["collStats"]
        }

        inherited_role {
          role = "readAnyDatabase"
          db =   "admin"
        }

        inherited_role {
          role = "dbAdminAnyDatabase"
          db =   "admin"
        }

        inherited_role {
          role = "clusterMonitor"
          db =   "admin"
        }

        inherited_role {
          role = "readWriteAnyDatabase"
          db =   "admin"
        }

        inherited_role {
          role = "restore"
          db =   "admin"
        }

        inherited_role {
          role = "backup"
          db =   "admin"
        }
      }
