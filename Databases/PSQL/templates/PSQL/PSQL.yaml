apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  name: psql-{{ .Values.datacenter }}-{{ .Values.region }}

  labels:
    wan-mode: public

  annotations:
    acid.zalan.do/controller: '{{ .Values.psql.controllerID }}'

spec:
  teamId: psql-site-{{ .Values.datacenter }}-{{ .Values.region }}
  volume:
    size: 10Gi

    storageClass: nvme-nonredundant

  numberOfInstances: 1

  masterServiceAnnotations:
    external-dns.alpha.kubernetes.io/hostname: 'psql-local.{{ .Values.cluster.name }}.{{ .Values.datacenter }}.{{ .Values.region }}.mylogin.space'

  postgresql:
    version: '17'

  patroni:
    synchronous_mode: false

  tls:
    secretName: 'myloginspace-default-certificates'
    certificateFile: 'tls.crt'
    privateKeyFile: 'tls.key'