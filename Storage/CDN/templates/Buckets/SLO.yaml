# This example shows the same example as getting-started.yml but using Sloth Kubernetes CRD.
# It will generate the Prometheus rules in a Kubernetes prometheus-operator PrometheusRules CRD.
#
# `sloth generate -i ./examples/k8s-getting-started.yml`
#
apiVersion: sloth.slok.dev/v1
kind: PrometheusServiceLevel
metadata:
  name: cdn-static

spec:
  service: cdn-static
  labels:
    owner: core
    repo: cdn-static
    tier: '2'
  slos:
    - name: "requests-availability"
      objective: 99.9
      description: "Common SLO based on availability for HTTP request responses."
      sli:
        events:
          errorQuery: sum(rate(envoy_cluster_upstream_rq_xx{envoy_cluster_name="httproute/core-prod/cdn-static/rule/0",envoy_response_code_class=~"4|5"}[{{.window}}]))
          totalQuery: sum(rate(envoy_cluster_upstream_rq_total{ envoy_cluster_name="httproute/core-prod/cdn-static/rule/0"}[{{.window}}]))
      alerting:
        name: MyServiceHighErrorRate
        labels:
          category: "availability"
        annotations:
          summary: "High error rate on 'cdn' requests responses"